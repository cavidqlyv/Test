/*

====================================================================================================

This file as been imported by the Commander console and the 'Import files' script.

The source of the import is:
C:\Projects\SoftwareMonkeys\SiteStarter\Src\App\SoftwareMonkeys.SiteStarter.Data.Tests\PropertyFilterTests.cs

Do not edit this file or changes may be lost. Edit the source file and the changes will be imported by all projects that use it.

====================================================================================================


*/

using System;
using System.Collections.Generic;
using System.Text;
using NUnit.Framework;
using System.Xml.Serialization;
using System.IO;
using System.Collections;
using System.Diagnostics;
using SoftwareMonkeys.WorkHub.Configuration;
using SoftwareMonkeys.WorkHub.Data;
using SoftwareMonkeys.WorkHub.Tests.Entities;
using SoftwareMonkeys.WorkHub.Entities;
using SoftwareMonkeys.WorkHub.Diagnostics;
using System.Reflection;
using SoftwareMonkeys.WorkHub.Tests;

namespace SoftwareMonkeys.WorkHub.Data.Tests
{
	[TestFixture]
	public class PropertyFilterTests : BaseDataTestFixture
	{
		public string ApplicationPath
		{
			get { return TestUtilities.GetTestingPath(this); }
		}
		

		#region Singleton tests
		[Test]
		public void Test_Data_EnsureInitialized()
		{
			DataProvider provider = DataAccess.Data;

			Assert.IsNotNull((object)provider);
		}
		#endregion


		#region Tests
		
		[Test]
		public void Test_IsMatch_PropertyTypeGuid()
		{
			using (LogGroup logGroup = LogGroup.Start("Testing the PropertyFilter.IsMatch function.", NLog.LogLevel.Debug))
			{
				
				TestArticle article = new TestArticle();
				article.ID = Guid.NewGuid();
				article.Title = "Test Title 1";
				
				TestArticle article2 = new TestArticle();
				article2.ID = Guid.NewGuid();
				article2.Title = "Test Title 2";
								
				PropertyFilter filter = (PropertyFilter)DataAccess.Data.CreateFilter(typeof(PropertyFilter));
				filter.Operator = FilterOperator.Equal;
				filter.PropertyName = "ID";
				filter.PropertyValue = article.ID;
				filter.AddType(typeof(TestArticle));
				
				bool isMatch = filter.IsMatch(article);
				Assert.IsTrue(isMatch, "The IsMatch function returned false when it should have been true.");
				
			}
		}
		
		[Test]
		public void Test_IsMatch()
		{
			using (LogGroup logGroup = LogGroup.Start("Testing the PropertyFilter.IsMatch function.", NLog.LogLevel.Debug))
			{
				
				TestArticle article = new TestArticle();
				article.ID = Guid.NewGuid();
				article.Title = "Test Title 1";
				
				TestArticle article2 = new TestArticle();
				article2.ID = Guid.NewGuid();
				article2.Title = "Test Title 2";
				
				//DataAccess.Data.Saver.Save(article);
				//DataAccess.Data.Saver.Save(article2);
				
				PropertyFilter filter = (PropertyFilter)DataAccess.Data.CreateFilter(typeof(PropertyFilter));
				filter.Operator = FilterOperator.Equal;
				filter.PropertyName = "Title";
				filter.PropertyValue = article.Title;
				filter.AddType(typeof(TestArticle));
				
				
				bool isMatch = filter.IsMatch(article);
				Assert.IsTrue(isMatch, "The IsMatch function returned false when it should have been true.");
				
			}
		}
		
		
		[Test]
		public void Test_IsMatch_Exclude()
		{
			using (LogGroup logGroup = LogGroup.Start("Testing the PropertyFilter.IsMatch function.", NLog.LogLevel.Debug))
			{				
				TestArticle article = new TestArticle();
				article.ID = Guid.NewGuid();
				
				TestCategory category = new TestCategory();
				category.ID = Guid.NewGuid();
				
				
				PropertyFilter filter = (PropertyFilter)DataAccess.Data.CreateFilter(typeof(PropertyFilter));
				filter.Operator = FilterOperator.Equal;
				filter.PropertyName = "Title";
				filter.PropertyValue = "MISMATCH"; // Should fail to match
				filter.AddType(typeof(TestArticle));
				
				
				
				bool isMatch = filter.IsMatch(article);
				Assert.IsFalse(isMatch, "The IsMatch function returned true when it should have been false.");
				
			}
		}
		#endregion

	}
}

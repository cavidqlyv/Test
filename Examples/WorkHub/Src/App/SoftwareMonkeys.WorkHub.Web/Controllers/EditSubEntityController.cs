/*

====================================================================================================

This file as been imported by the Commander console and the 'Import files' script.

The source of the import is:
C:\Projects\SoftwareMonkeys\SiteStarter\Src\App\SoftwareMonkeys.SiteStarter.Web\Controllers\EditSubEntityController.cs

Do not edit this file or changes may be lost. Edit the source file and the changes will be imported by all projects that use it.

====================================================================================================


*/

using System;
using SoftwareMonkeys.WorkHub.Entities;
using SoftwareMonkeys.WorkHub.Business;
using SoftwareMonkeys.WorkHub.Business.Security;
using SoftwareMonkeys.WorkHub.Web.Navigation;
using SoftwareMonkeys.WorkHub.Diagnostics;

namespace SoftwareMonkeys.WorkHub.Web.Controllers
{
	/// <summary>
	/// 
	/// </summary>
	[Controller("Edit", "ISubEntity")]
	public class EditSubEntityController : EditController
	{
		public EditSubEntityController()
		{
		}
		
		public override void NavigateAfterUpdate()
		{
			using (LogGroup logGroup = LogGroup.Start("Navigating after a update operation.", NLog.LogLevel.Debug))
			{
				if (DataSource == null)
					throw new InvalidOperationException("The DataSource property isn't set.");
				
				ISubEntity entity = (ISubEntity)DataSource;
				
				if (entity.Parent == null)
				{
					LogWriter.Debug("No parent found. Activating entity.Parent.");
					
					ActivateStrategy.New<ISubEntity>().Activate(entity, entity.ParentPropertyName);
				}
				
				if (entity.Parent == null)
					throw new Exception("No parent assigned to entity.");
				
				Navigator.Current.NavigateAfterOperation("View", entity.Parent);
			}
		}
	}
}

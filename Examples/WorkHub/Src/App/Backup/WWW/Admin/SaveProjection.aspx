<%--
====================================================================================================

This file as been imported by the Commander console and the 'Import files' script.

The source of the import is:
C:\Projects\SoftwareMonkeys\SiteStarter\Src\App\WWW\Admin\SaveProjection.aspx

Do not edit this file or changes may be lost. Edit the source file and the changes will be imported by all projects that use it.

====================================================================================================

--%>

<%@ Page Language="C#" EnableEventValidation="false" ValidateRequest="false" AutoEventWireup="true" %>
<%@ Register tagprefix="cc" namespace="SoftwareMonkeys.WorkHub.Web.WebControls" assembly="SoftwareMonkeys.WorkHub.Web" %>
<%@ Import namespace="SoftwareMonkeys.WorkHub.Web.Projections" %>
<%@ Import namespace="SoftwareMonkeys.WorkHub.Web.WebControls" %>
<%@ Import namespace="SoftwareMonkeys.WorkHub.Diagnostics" %>
<%@ Import namespace="SoftwareMonkeys.WorkHub.Web" %>
<%@ Import namespace="SoftwareMonkeys.WorkHub.Web.Properties" %>
<%@ Import namespace="SoftwareMonkeys.WorkHub.Web.Security" %>
<%@ Import namespace="System.IO" %>
<script runat="server">

	private void Page_Load(object sender, EventArgs e)
	{
		using (LogGroup logGroup = LogGroup.StartDebug("Loading the save projection page."))
		{
			// TODO: Ensure this is secure
					
			Authorisation.EnsureUserCan("Edit", "Projection");
		
			string projectionPath = Request.Form["ProjectionPath"];
			string projectionContent = Request.Form["ProjectionContent"];
			string originalProjectionPath = Request.Form["OriginalProjectionPath"];
			
			LogWriter.Debug("Projection path: " + projectionPath);
			
			ProjectionSaver saver = new ProjectionSaver();
			saver.SaveToFile(originalProjectionPath, projectionPath, projectionContent, new ProjectionInfoExtractor(new ControlLoader(this)));
			
			Response.Write("Saved");
		}
	}

</script>
<html>
<head runat="server">
</head>
<body>
</body>
</html>